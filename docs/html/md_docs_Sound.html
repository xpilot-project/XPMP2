<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XPMP2: Sound Support by FMOD</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XPMP2
   </div>
   <div id="projectbrief">X-Plane multiplayer library 2 - using instancing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Sound Support by FMOD </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a>'s Audio Engine is FMOD Core API by Firelight Technologies Pty Ltd. Understand FMOD <a href="https://www.fmod.com/licensing">licensing</a> and <a href="https://www.fmod.com/attribution">attribution requirements</a> first, as they will apply to <em>your</em> plugin if using <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> with sound support.</p>
<p>While X-Plane supports and uses FMOD, too, for aircraft-specific sounds, <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> cannot make use of any X-Plane functionality to produce the sounds as X-Plane at the moment does not allow to dynamically add sounds to instanced objects.</p>
<p>Instead, <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> creates its own fully indepent instance of the FMOD system. This also means that <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> has to provide FMOD with all spacial information for each aircraft's sound to create a proper 3D sound illusion relative to the user's current camera position. Which opens a totally new are for potential bugs...</p>
<h2>Building <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> with FMOD Sound Support</h2>
<p>Due to above licencing requirements, sound support is only included if <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> is consciously built with CMake cache entry <code>INCLUDE_FMOD_SOUND</code>, which in turn defines a compile-time macro by the same name, e.g. by doing </p><div class="fragment"><div class="line">cmake -G Ninja -DINCLUDE_FMOD_SOUND=1 ..</div>
</div><!-- fragment --><p> The Docker <code>Makefile</code> allows passing CMake parameters via the <code>FLAGS</code> macro: </p><div class="fragment"><div class="line">make FLAGS=-DINCLUDE_FMOD_SOUND=1 {...platform(s)...}</div>
</div><!-- fragment --><p> The GitHub Actions triggered by default are building without FMOD support, too. Running "Build all Platforms" manually, though, allows to specify <code>FLAGS</code>.</p>
<h2>Including FMOD Sound Support in Your Plugin</h2>
<p>In your plugin, you also need to define <code>INCLUDE_FMOD_SOUND</code> <em>before</em> including the <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> headers: </p><div class="fragment"><div class="line">#define INCLUDE_FMOD_SOUND 1            // Include FMOD sound support</div>
<div class="line">#include &quot;XPMPMultiplayer.h&quot;</div>
<div class="line">#include &quot;XPMPAircraft.h&quot;</div>
</div><!-- fragment --><p>Then certainly link with an FMOD-enabled version of the <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> library.</p>
<h3>Avoid Crash</h3>
<p>If the <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> you linked is compiled with <code>INCLUDE_FMOD_SOUND</code> but your actual plugin without, then the plugin will crash in <code><a class="el" href="classXPMP2_1_1Aircraft.html#a87623ad988fedbbf83a389ad49eaa2e1" title="Internal: Flight loop callback function controlling update and movement of all planes.">XPMP2::Aircraft::FlightLoopCB()</a></code> at the point when it tries to call <code>XPMP2::Aircraft::UpdateSound()</code>, because the <code><a class="el" href="classXPMP2_1_1Aircraft.html" title="Actual representation of all aircraft in XPMP2.">XPMP2::Aircraft</a></code> object created by your plugin is created with too short a <code>vtable</code> as it did not consider the virtual member functions for sound support.</p>
<p>You can tell if your <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> library includes FMOD support latest from the init message in <code>Log.txt</code>, when it says:</p>
<div class="fragment"><div class="line">...XPMPMultiplayerInit: XPMP2 2.60 with FMOD support initializing...`</div>
</div><!-- fragment --><p>Solution: Either link to an <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> build without FMOD support. Or make sure to <code>#define INCLUDE_FMOD_SOUND 1</code> in your plugin before including the <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> headers.</p>
<h3>FMOD Logo</h3>
<p>Not built into <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> (to avoid a link-time dependency on OpenGL) but provided separately are functions to create the FMOD logo as per <a href="https://www.fmod.com/attribution">attribution requirements</a>. Include <code><a class="el" href="FMOD__Logo_8cpp.html" title="Compressed version of the FMOD logo with code to create a texture ID in X-Plane for display with Dear...">FMOD_Logo.cpp</a></code> and <code><a class="el" href="FMOD__Logo_8h.html" title="Compressed version of the FMOD logo with code to create a texture ID in X-Plane for display with Dear...">FMOD_Logo.h</a></code> from <code>XPMP2-Sample/lib/fmod/logo</code> into your project. Showing the FMOD logo in a Dear ImGui window is then as simple as </p><div class="fragment"><div class="line">#include &quot;FMOD_Logo.h&quot;</div>
<div class="line">...</div>
<div class="line">int logoId = 0;</div>
<div class="line">if (FMODLogo::GetTexture(logoId)) {</div>
<div class="line">    ImGui::Image((void*)(intptr_t)logoId, ImVec2(FMODLogo::IMG_WIDTH, FMODLogo::IMG_HEIGHT));</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Ship <code>fmod.dll</code></h2>
<p>If your plugin supports X-Plane 11 under Windows, then you need to ship <code>fmod.dll</code> in the <code>win_x64</code> folder. See <a href="Deploying.html">Deploying</a> for details.</p>
<h2>Default Sounds</h2>
<p>Your are <b>not required</b> to provide any sound-specific coding in your plugin. As a matter of fact, the XPMP2-Sample plugin has no single line of code that controls sound. (There is only some sample code to enumerate the loaded sounds into <code>Log.txt</code>, purely for my personal testing purposes.)</p>
<p>Once built with sound support, <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> provides a lot of sounds by default. <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> distinguishes 5 sound types, see <code><a class="el" href="classXPMP2_1_1Aircraft.html#a53148678cb692403b734b005fe78f336" title="Types of sound supported directly by XPMP2.">XPMP2::Aircraft::SoundEventsTy</a></code>, and plays sounds that are included in any X-Plane installation's <code>Resources/sounds</code> folders based on the level of certain dataRefs:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Event   </th><th class="markdownTableHeadNone">dataRef   </th><th class="markdownTableHeadNone">Sound    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Engine   </td><td class="markdownTableBodyNone">Thrust Ratio   </td><td class="markdownTableBodyNone">Depends on aircraft type, volume changes with Thrust    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Reverse   </td><td class="markdownTableBodyNone">Thrust Reverse Ratio   </td><td class="markdownTableBodyNone"><code>XP_SOUND_REVERSE_THRUST</code>, volume changes with Thrust Reverse    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Tire   </td><td class="markdownTableBodyNone">Tire Rotation RPM   </td><td class="markdownTableBodyNone"><code>XP_SOUND_ROLL_RUNWAY</code>, volume changes with RPM    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gear   </td><td class="markdownTableBodyNone">Gear Ratio   </td><td class="markdownTableBodyNone"><code>XP_SOUND_GEAR</code> upon a change to the Gear Ratio    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Flaps   </td><td class="markdownTableBodyNone">Flap Ratio   </td><td class="markdownTableBodyNone"><code>XP_SOUND_FLAP</code> once upon a change to the Flap Ratio   </td></tr>
</table>
<p>The engine sounds depend on the aircraft type, more specifically on the <a href="https://www.icao.int/publications/doc8643/pages/search.aspx">ICAO aircraft type designators</a> as provided in <code>Resources/Doc8643.txt</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type Designator   </th><th class="markdownTableHeadNone">means   </th><th class="markdownTableHeadNone">Sound    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ZZZC</code>   </td><td class="markdownTableBodyNone">Ground vehicle   </td><td class="markdownTableBodyNone"><code>XP_SOUND_ELECTRIC</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>H??</code> or <code>G??</code>   </td><td class="markdownTableBodyNone">Heli, Gyrocopter   </td><td class="markdownTableBodyNone"><code>XP_SOUND_PROP_HELI</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>E??</code>   </td><td class="markdownTableBodyNone">Electric   </td><td class="markdownTableBodyNone"><code>XP_SOUND_ELECTRIC</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>J1?</code>   </td><td class="markdownTableBodyNone">Jet, single   </td><td class="markdownTableBodyNone"><code>XP_SOUND_HIBYPASSJET</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>J??</code>   </td><td class="markdownTableBodyNone">Jet, multi   </td><td class="markdownTableBodyNone"><code>XP_SOUND_LOBYPASSJET</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>P??</code>   </td><td class="markdownTableBodyNone">Piston   </td><td class="markdownTableBodyNone"><code>XP_SOUND_PROP_AIRPLANE</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>T??</code>   </td><td class="markdownTableBodyNone">Turboprop   </td><td class="markdownTableBodyNone"><code>XP_SOUND_TURBOPROP</code>   </td></tr>
</table>
<p>The sounds' volume additionally depends on the number of engines, which while obvious for the engine sounds is generally an ok indicator for the plane's size and hence volume.</p>
<h2>Controlling Sound</h2>
<p>Here are your options to influence sound.</p>
<h3>Enable/Disable</h3>
<p>Beside using <code><a class="el" href="XPMPMultiplayer_8h.html#ada05d290bf58a20dd3d5eb6df9ec63b2" title="Enable/Disable Sound.">XPMPSoundEnable()</a></code> directly, you can also provides values for configuration items <code>XPMP_CFG_ITM_ACTIVATE_SOUND</code> and <code>XPMP_CFG_ITM_MUTE_ON_PAUSE</code> in your configuration callback.</p>
<h3>General Volume</h3>
<p><code><a class="el" href="XPMPMultiplayer_8h.html#a280d1a336529b2515b74d0d1684f0647" title="Set Master Volume.">XPMPSoundSetMasterVolume()</a></code> and <code><a class="el" href="XPMPMultiplayer_8h.html#a4bd3405ad71d776c058df6aaac6c0e52" title="Mute all sounds (temporarily)">XPMPSoundMute()</a></code> allow controlling the volume of <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a>'s sounds generally across all aircraft.</p>
<h3>Add your own Sounds</h3>
<p><code><a class="el" href="XPMPMultiplayer_8h.html#a312fc6a5b8b9389386606f89eaf69d6c" title="Add a sound that can later be referenced from an XPMP2::Aircraft.">XPMPSoundAdd()</a></code> allows you to add your own sounds. Sounds can be looping (like engine sounds, which play continuously) or one-time sounds.</p>
<p>The function optionally also allows to define <b>sound cone</b> parameters. A sound cone basically is a cone-shaped area, in which the sound is heared with full volume, while outside of it the sound is reduced (attenuated) to a lower volume. The default sounds use that for the jet eingine sounds, which are louder <em>behind</em> the aircraft. <code>coneDir</code> and <code>conePitch</code> are defined relative to the aircraft's heading. <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> takes care of orientating the actual sound cone dynamically with the actual aircraft orientation. The other three cone-specific parameters are passed through to FMOD (see <a href="https://www.fmod.com/docs/api/core-api-sound.html#sound_set3dconesettings">set3DConeSettings</a>).</p>
<h3>Override virtual <code>Aircraft</code> member functions</h3>
<p>For more control over the sounds your aircraft emit you can override <code>Aircraft</code>'s virtual member functions:</p>
<ul>
<li><code>Aircraft::SoundSetup()</code> is called after aircraft creation once the CSL model to use is determined; called again after CSL model changes. Use to define/override some defaults. Is a good place to set <code>aSndCh[SoundEventsTy].bAuto = false</code> in case you want to have full control over any of the pre-defined sound types.</li>
<li><code>Aircraft::SoundUpdate()</code> is called in every flight loop cycle and decides, which sounds to start/stop at which volume. You can make calls to functions like <code>Aircraft::SoundPlay/SoundStop/SoundVolume()</code>.</li>
<li><code>Aircraft::SoundGetName()</code> is called by <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a>'s standard implementation of <code>SoundUpdate()</code>. Override if you just want to have control over which sounds at which volume to play for the standard event types, but otherwise want to leave sound handling to <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a>. You can return any sound name, ie. also additional names you have registered previously with <code><a class="el" href="XPMPMultiplayer_8h.html#a312fc6a5b8b9389386606f89eaf69d6c" title="Add a sound that can later be referenced from an XPMP2::Aircraft.">XPMPSoundAdd()</a></code>.</li>
<li><code>Aircraft::SoundRemoveAll()</code> is called during object destruction to cleanup all sound objects. If you have started playing any sounds yourself you should clean them up here before calling the standard function to give <a class="el" href="namespaceXPMP2.html" title="Defined by FMOD.">XPMP2</a> a chance for cleanup, too. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
